<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CRUD Operations </title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background-color: #f8f9fa;
    }
    .navbar {
      background: #fff !important;
      padding: 15px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .navbar-brand {
      font-weight: 700;
      font-size: 20px;
      color: #000 !important;
    }
    .nav-link {
      color: #000 !important;
      font-weight: 500;
      margin-left: 20px;
      text-transform: uppercase;
    }
    .nav-link.active {
      font-weight: 700;
      border-bottom: 2px solid #0d6efd;
    }
    .post-card {
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .post-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
    }
    .empty-state {
      padding: 60px 20px;
      text-align: center;
      color: #6c757d;
    }
    .empty-state svg {
      width: 100px;
      height: 100px;
      margin-bottom: 20px;
      opacity: 0.3;
    }
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .toast-container {
      position: fixed;
      top: 80px;
      right: 20px;
      z-index: 9999;
    }
    .form-section {
      position: sticky;
      top: 80px;
      z-index: 100;
    }
    footer {
      margin-top: 80px;
    }
    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }
  </style>
</head>
<body>
  <header class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html"><strong>be</strong>leasing</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation menu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link active" href="crud.html" aria-current="page">CRUD</a>
          </li>
        </ul>
      </div>
    </div>
  </header>

  <div class="toast-container" aria-live="polite" aria-atomic="true"></div>

  <div class="loading-overlay" id="loadingOverlay" style="display: none;" role="status" aria-live="polite">
    <div class="spinner-border text-light" role="status" style="width: 3rem; height: 3rem;">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <main class="container mt-5 pt-5">
    <div class="row mb-4">
      <div class="col">
        <h1 class="display-5 fw-bold">Posts Management</h1>
        <p class="text-muted">Create, read, update, and delete posts using JSONPlaceholder API</p>
      </div>
    </div>

    <div class="row g-4">
      <div class="col-12 col-lg-4">
        <div class="form-section">
          <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
              <h2 class="h5 mb-0" id="formTitle">Create New Post</h2>
            </div>
            <div class="card-body">
              <form id="createForm" aria-labelledby="formTitle">
                <div class="mb-3">
                  <label for="createTitle" class="form-label">Title <span class="text-danger" aria-label="required">*</span></label>
                  <input type="text" class="form-control" id="createTitle" placeholder="Enter post title" required aria-required="true" aria-describedby="titleHelp">
                  <div id="titleHelp" class="form-text visually-hidden">Enter a descriptive title for your post</div>
                  <div class="invalid-feedback" role="alert">Title is required.</div>
                </div>
                <div class="mb-3">
                  <label for="createContent" class="form-label">Content <span class="text-danger" aria-label="required">*</span></label>
                  <textarea class="form-control" id="createContent" rows="5" placeholder="Enter post content" required aria-required="true" aria-describedby="contentHelp"></textarea>
                  <div id="contentHelp" class="form-text visually-hidden">Enter the main content of your post</div>
                  <div class="invalid-feedback" role="alert">Content is required.</div>
                </div>
                <div class="d-grid gap-2">
                  <button id="createBtn" type="submit" class="btn btn-primary" aria-label="Create new post">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-circle me-1" viewBox="0 0 16 16" aria-hidden="true">
                      <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                      <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                    </svg>
                    Create Post
                  </button>
                  <button id="clearBtn" type="button" class="btn btn-secondary" style="display: none;" aria-label="Cancel editing and clear form">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle me-1" viewBox="0 0 16 16" aria-hidden="true">
                      <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                      <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                    </svg>
                    Cancel
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <div class="col-12 col-lg-8">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2 class="h4 mb-0">All Posts <span class="badge bg-primary" id="postCount" aria-label="Total number of posts">0</span></h2>
          <button class="btn btn-outline-primary btn-sm" id="refreshBtn" aria-label="Refresh posts list">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-clockwise" viewBox="0 0 16 16" aria-hidden="true">
              <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
              <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
            </svg>
            <span class="ms-1">Refresh</span>
          </button>
        </div>
        
        <div id="postsList" role="list" aria-label="Posts list"></div>
        
        <div id="emptyState" class="empty-state" style="display: none;" role="status">
          <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-inbox" viewBox="0 0 16 16" aria-hidden="true">
            <path d="M4.98 4a.5.5 0 0 0-.39.188L1.54 8H6a.5.5 0 0 1 .5.5 1.5 1.5 0 1 0 3 0A.5.5 0 0 1 10 8h4.46l-3.05-3.812A.5.5 0 0 0 11.02 4H4.98zm9.954 5H10.45a2.5 2.5 0 0 1-4.9 0H1.066l.32 2.562a.5.5 0 0 0 .497.438h12.234a.5.5 0 0 0 .496-.438L14.933 9zM3.809 3.563A1.5 1.5 0 0 1 4.981 3h6.038a1.5 1.5 0 0 1 1.172.563l3.7 4.625a.5.5 0 0 1 .105.374l-.39 3.124A1.5 1.5 0 0 1 14.117 13H1.883a1.5 1.5 0 0 1-1.489-1.314l-.39-3.124a.5.5 0 0 1 .106-.374l3.7-4.625z"/>
          </svg>
          <h3 class="h5">No posts yet</h3>
          <p>Create your first post using the form on the left</p>
        </div>
      </div>
    </div>
  </main>

  <footer class="bg-dark text-white py-4 mt-5">
    <div class="container text-center">
      <p class="mb-0">&copy; 2023 BeLeasing | All Rights Reserved</p>
    </div>
  </footer>

  <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title h5" id="deleteModalLabel">Confirm Delete</h3>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close delete confirmation dialog"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete this post? This action cannot be undone.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-danger" id="confirmDelete">Delete Post</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    let localPosts = [];
    let deletePostId = null;
    const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));

    // Show loading overlay
    function showLoading() {
      $('#loadingOverlay').fadeIn(200);
    }

    function hideLoading() {
      $('#loadingOverlay').fadeOut(200);
    }

    function showToast(message, type = 'success') {
      const toastId = 'toast-' + Date.now();
      const ariaLabel = type === 'success' ? 'Success notification' : 
                        type === 'danger' ? 'Error notification' : 
                        'Warning notification';
      
      const toastHtml = `
        <div class="toast align-items-center text-white bg-${type} border-0" role="alert" aria-live="assertive" aria-atomic="true" id="${toastId}" aria-label="${ariaLabel}">
          <div class="d-flex">
            <div class="toast-body">
              ${escapeHtml(message)}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close notification"></button>
          </div>
        </div>
      `;
      
      const $toast = $(toastHtml);
      $('.toast-container').append($toast);
      
      const toast = new bootstrap.Toast($toast[0], { delay: 3000 });
      toast.show();
      
      $toast.on('hidden.bs.toast', function() {
        $(this).remove();
      });
    }

    function fetchPosts() {
      showLoading();
      
      $.ajax({
        url: "https://jsonplaceholder.typicode.com/posts",
        method: "GET",
        dataType: "json",
        success: function(data) {
          localPosts = data.slice(0, 10);
          renderPosts();
          showToast('Posts loaded successfully!', 'success');
        },
        error: function(xhr, status, error) {
          console.error("Error fetching posts:", error);
          showToast('Failed to load posts. Please try again.', 'danger');
          renderPosts();
        },
        complete: function() {
          hideLoading();
        }
      });
    }

    function renderPosts() {
      const $postsList = $("#postsList");
      const $emptyState = $("#emptyState");
      const $postCount = $("#postCount");
      
      $postsList.empty();
      $postCount.text(localPosts.length);

      if (localPosts.length === 0) {
        $emptyState.show();
        return;
      }

      $emptyState.hide();

      $.each(localPosts, function(_, post) {
        const postTitle = escapeHtml(post.title);
        const postBody = escapeHtml(post.body);
        
        const $postCard = $(`
          <article class="card post-card shadow-sm mb-3" data-id="${post.id}" role="listitem">
            <div class="card-body">
              <h3 class="card-title h5 text-capitalize">${postTitle}</h3>
              <p class="card-text text-muted">${postBody}</p>
              <div class="d-flex gap-2" role="group" aria-label="Post actions">
                <button class="btn btn-sm btn-outline-primary btn-edit" data-id="${post.id}" aria-label="Edit post: ${postTitle}">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-pencil" viewBox="0 0 16 16" aria-hidden="true">
                    <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/>
                  </svg>
                  <span>Edit</span>
                </button>
                <button class="btn btn-sm btn-outline-danger btn-del" data-id="${post.id}" aria-label="Delete post: ${postTitle}">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16" aria-hidden="true">
                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                  </svg>
                  <span>Delete</span>
                </button>
              </div>
            </div>
          </article>
        `);
        $postsList.append($postCard);
      });
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function savePost(e) {
      e.preventDefault();

      const $form = $('#createForm');
      const $title = $('#createTitle');
      const $content = $('#createContent');

      if (!$title.val().trim() || !$content.val().trim()) {
        $form.addClass('was-validated');
        showToast('Please fill in all required fields.', 'warning');
        return;
      }

      const postId = $("#createBtn").attr("data-id");
      const title = $title.val().trim();
      const body = $content.val().trim();

      showLoading();

      if (postId) {
        $.ajax({
          url: `https://jsonplaceholder.typicode.com/posts/${postId}`,
          method: "PUT",
          data: JSON.stringify({ id: postId, title, body, userId: 1 }),
          contentType: "application/json",
          success: function(response) {
            const idx = localPosts.findIndex(p => p.id == postId);
            if (idx >= 0) {
              localPosts[idx].title = title;
              localPosts[idx].body = body;
            }
            renderPosts();
            resetForm();
            showToast('Post updated successfully!', 'success');
          },
          error: function(xhr, status, error) {
            console.error("Error updating post:", error);
            showToast('Failed to update post. Please try again.', 'danger');
          },
          complete: function() {
            hideLoading();
          }
        });
      } else {
        $.ajax({
          url: "https://jsonplaceholder.typicode.com/posts",
          method: "POST",
          data: JSON.stringify({ title, body, userId: 1 }),
          contentType: "application/json",
          success: function(response) {
            const newId = localPosts.length ? Math.max(...localPosts.map(p => p.id)) + 1 : 1;
            localPosts.unshift({ id: newId, title, body, userId: 1 });
            renderPosts();
            resetForm();
            showToast('Post created successfully!', 'success');
          },
          error: function(xhr, status, error) {
            console.error("Error creating post:", error);
            showToast('Failed to create post. Please try again.', 'danger');
          },
          complete: function() {
            hideLoading();
          }
        });
      }
    }

    function editPost() {
      const postId = $(this).attr("data-id");
      const post = localPosts.find(p => p.id == postId);
      
      if (!post) return;

      $("#createTitle").val(post.title);
      $("#createContent").val(post.body);
      $("#createBtn")
        .html('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle me-1" viewBox="0 0 16 16" aria-hidden="true"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/><path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/></svg>Update Post')
        .attr("data-id", post.id)
        .attr("aria-label", "Update post: " + post.title);
      $("#clearBtn").show();
      $("#formTitle").text("Edit Post");

      if ($(window).width() < 992) {
        $('html, body').animate({
          scrollTop: $("#createForm").offset().top - 80
        }, 400);
      }
    }

    function showDeleteConfirmation() {
      deletePostId = $(this).attr("data-id");
      deleteModal.show();
    }

    function deletePost() {
      if (!deletePostId) return;

      showLoading();
      deleteModal.hide();

      $.ajax({
        url: `https://jsonplaceholder.typicode.com/posts/${deletePostId}`,
        method: "DELETE",
        success: function(response) {
          localPosts = localPosts.filter(p => p.id != deletePostId);
          renderPosts();
          showToast('Post deleted successfully!', 'success');
        },
        error: function(xhr, status, error) {
          console.error("Error deleting post:", error);
          showToast('Failed to delete post. Please try again.', 'danger');
        },
        complete: function() {
          hideLoading();
          deletePostId = null;
        }
      });
    }

    function resetForm() {
      $("#createTitle").val("");
      $("#createContent").val("");
      $("#createBtn")
        .removeAttr("data-id")
        .html('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-circle me-1" viewBox="0 0 16 16" aria-hidden="true"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/></svg>Create Post')
        .attr("aria-label", "Create new post");
      $("#clearBtn").hide();
      $("#formTitle").text("Create New Post");
      $("#createForm").removeClass('was-validated');
    }

    $(document).ready(function() {
      fetchPosts();

      $(document).on("click", ".btn-del", showDeleteConfirmation);
      $(document).on("click", ".btn-edit", editPost);
      $("#confirmDelete").on("click", deletePost);
      $("#createForm").on("submit", savePost);
      $("#clearBtn").on("click", resetForm);
      $("#refreshBtn").on("click", fetchPosts);
    });
  </script>
</body>
</html>